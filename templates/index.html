<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automotive Dashboard</title>
    <style>
        body { background-color: #2A2A2A; color: #D3D3D3; font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #FFFFFF; }
        form { background-color: #3A3A3A; padding: 20px; border-radius: 8px; }
        label { display: block; margin-top: 10px; }
        select, button { width: 100%; padding: 8px; margin-top: 5px; background-color: #4A4A4A; color: #D3D3D3; border: 1px solid #606060; border-radius: 4px; }
        button { background-color: #606060; cursor: pointer; }
        button:hover { background-color: #707070; }
    </style>
</head>
<body>
    <h1>Automotive Sales Dashboard</h1>
    <form action="/kpi" method="post">
        <label for="salesperson">Salesperson:</label>
        <select name="salesperson" id="salesperson">
            {% for sp in salespeople %}
                <option value="{{ sp }}">{{ sp }}</option>
            {% endfor %}
        </select>

        <label for="car_make">Car Make:</label>
        <select name="car_make" id="car_make" onchange="updateModels()">
            {% for make in car_makes %}
                <option value="{{ make }}">{{ make }}</option>
            {% endfor %}
        </select>

        <label for="car_model">Car Model:</label>
        <select name="car_model" id="car_model">
            <option value="All">All</option>
        </select>

        <label for="car_year">Car Year:</label>
        <select name="car_year" id="car_year">
            {% for year in car_years %}
                <option value="{{ year }}">{{ year }}</option>
            {% endfor %}
        </select>

        <!-- Metrics are passed but not used in filtering; could be for future expansion, omitting from form for now -->

        <button type="submit" style="margin-top: 20px;">View KPIs</button>
    </form>

    <!-- Separate form for CSV download using the same filters -->
    <form action="/download_csv" method="post" style="margin-top: 20px;">
        <label>Use the same filters above and click below to download CSV</label>
        <!-- Note: To avoid duplicating selects, users can submit this after setting filters, but in practice, JS could copy values; keeping simple -->
        <select name="salesperson" style="display: none;">
            {% for sp in salespeople %}
                <option value="{{ sp }}">{{ sp }}</option>
            {% endfor %}
        </select>
        <select name="car_make" style="display: none;">
            {% for make in car_makes %}
                <option value="{{ make }}">{{ make }}</option>
            {% endfor %}
        </select>
        <select name="car_model" style="display: none;">
            <option value="All">All</option>
        </select>
        <select name="car_year" style="display: none;">
            {% for year in car_years %}
                <option value="{{ year }}">{{ year }}</option>
            {% endfor %}
        </select>
        <button type="submit">Download CSV</button>
    </form>

    <script>
        const carModels = {
            'Toyota': ['Camry', 'Corolla', 'RAV4'],
            'Honda': ['Civic', 'Accord', 'CR-V'],
            'Ford': ['F-150', 'Mustang', 'Explorer'],
            'Chevrolet': ['Silverado', 'Malibu', 'Equinox'],
            'BMW': ['3 Series', '5 Series', 'X5'],
            'Mercedes': ['C-Class', 'E-Class', 'GLC'],
            'Hyundai': ['Elantra', 'Sonata', 'Tucson'],
            'Volkswagen': ['Jetta', 'Passat', 'Tiguan']
        };

        function updateModels() {
            const make = document.getElementById('car_make').value;
            const modelSelect = document.getElementById('car_model');
            modelSelect.innerHTML = '<option value="All">All</option>';
            if (make !== 'All' && carModels[make]) {
                carModels[make].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.text = model;
                    modelSelect.add(option);
                });
            }
        }
    </script>
</body>
</html>
